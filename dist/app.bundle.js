/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){l=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw a}}}}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function i(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:String(r)}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}var i,a,c;return i=t,a=[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"drawUi",value:function(t){var e,r,n,o=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(t){return o.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return o.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return o.onLoadGameClick(t)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var i=0;i<Math.pow(this.boardSize,2);i+=1){var a=document.createElement("div");a.classList.add("cell","map-tile","map-tile-".concat((e=i,r=this.boardSize,n=void 0,(n=new Map([[0,"top-left"],[r-1,"top-right"],[r*r-r,"bottom-left"],[r*r-1,"bottom-right"]])).has(e)?n.get(e):e<r-1?"top":e%r==0?"left":e>r*r-r&&e<r*r-1?"bottom":(e+1)%r==0?"right":"center"))),a.addEventListener("mouseenter",(function(t){return o.onCellEnter(t)})),a.addEventListener("mouseleave",(function(t){return o.onCellLeave(t)})),a.addEventListener("click",(function(t){return o.onCellClick(t)})),this.boardEl.appendChild(a)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var r,n=e(this.cells);try{for(n.s();!(r=n.n()).done;)r.value.innerHTML=""}catch(t){n.e(t)}finally{n.f()}var o,i,a=e(t);try{for(a.s();!(o=a.n()).done;){var c=o.value,l=this.boardEl.children[c.position],u=document.createElement("div");u.classList.add("character",c.character.type);var s=document.createElement("div");s.classList.add("health-level");var f=document.createElement("div");f.classList.add("health-level-indicator","health-level-indicator-".concat((i=c.character.health)<15?"critical":i<50?"normal":"high")),f.style.width="".concat(c.character.health,"%"),s.appendChild(f),u.appendChild(s),l.appendChild(u)}}catch(t){a.e(t)}finally{a.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var e,o,i=this.cells[t];(e=i.classList).remove.apply(e,function(t){if(Array.isArray(t))return n(t)}(o=Array.from(i.classList).filter((function(t){return t.startsWith("selected")})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||r(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var o=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),o.appendChild(i),i.addEventListener("animationend",(function(){o.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],c=[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}],a&&o(i.prototype,a),c&&o(i,c),Object.defineProperty(i,"prototype",{writable:!1}),t}();const c="prairie",l="desert",u="arctic",s="mountain";function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function h(t){var e=function(t,e){if("object"!=f(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:String(e)}var p=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=r,"Character"===(this instanceof t?this.constructor:void 0).name)throw"Dont use new Character()"}var e,r;return e=t,(r=[{key:"levelUp",value:function(){if(this.level>1)for(var t=1;t<this.level;t++)this.attack=Math.max(this.attack,this.attack*(80+this.health)/100),this.defence=Math.max(this.defence,this.defence*(80+this.health)/100)}}])&&y(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function d(t,e,r){return e&&m(t.prototype,e),r&&m(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:String(e)}var g=d((function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof p))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=e,this.position=r}));function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,S(n.key),n)}}function S(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:String(e)}var k=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"playerPosition",value:function(t){for(var e=[],r=0,n=1,o=0;o<t-1;o++)e.push(r),e.push(n),r+=t,n+=t;return e}},{key:"rivalPosition",value:function(t){for(var e=[],r=t-2,n=t-1,o=0;o<t-1;o++)e.push(r),e.push(n),r+=t,n+=t;return e}},{key:"createLine",value:function(t,e){for(var r=[],n=0;n<e;n++)r.push(t),t++;return r}},{key:"createBoard",value:function(e){for(var r=[],n=0,o=0;o<e;o++)r.push(t.createLine(n,e)),n+=e;return r}},{key:"neighboringPositions",value:function(e,r,n){for(var o=t.createBoard(r),i=t.getLocation(e,o),a=i[0],c=i[1],l=[],u=[a],s=1;s<=n;s++){var f=a+s;f>-1&&f<r&&u.push(f);var y=a-s;y>-1&&y<r&&u.push(y)}for(var h=[c],p=1;p<=n;p++){var v=c+p;v>-1&&v<r&&h.push(v);var m=c-p;m>-1&&m<r&&h.push(m)}u=u.sort((function(t,e){return t-e})),h=h.sort((function(t,e){return t-e}));for(var d=0;d<u.length;d++)for(var b=0;b<h.length;b++)l.push(o[u[d]][h[b]]);return l}},{key:"getLocation",value:function(t,e){var r=void 0,n=void 0,o=[];return e.forEach((function(e,o){-1!==e.indexOf(t)&&(n=e.indexOf(t),r=o)})),o.push(r),o.push(n),o}},{key:"getAverage",value:function(t){for(var e=0,r=0,n=0;n<t.length;n++)e+=t[n][0],r+=t[n][1];return[Math.floor(e/t.length),Math.floor(r/t.length)]}},{key:"findClosest",value:function(t,e){var r=[];return t.forEach((function(t){var n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]);r.push(Math.sqrt(n^2+o^2))})),r.indexOf(r.reduce((function(t,e){return Math.min(t,e)})))}},{key:"generateRandom",value:function(t){return Math.floor(Math.random()*t.length)}}],null&&P(e.prototype,null),r&&P(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function j(t,e,r){return e&&E(t.prototype,e),r&&E(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function C(t){var e=function(t,e){if("object"!=O(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:String(e)}var L=j((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.characters=e}));function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=R(r);if(n){var o=R(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===T(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=25,e.defence=25,e.type="bowman",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function M(t,e){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},M(t,e)}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=N(r);if(n){var o=N(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=40,e.defence=10,e.type="swordsman",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function A(t,e){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},A(t,e)}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}var z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(n){var o=D(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=40,e.defence=10,e.type="undead",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function q(t,e){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},q(t,e)}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=F(r);if(n){var o=F(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=10,e.defence=40,e.type="magician",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}function Y(t){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Y(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Y(r);if(n){var o=Y(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===J(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=10,e.defence=10,e.type="daemon",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}function Q(t){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Q(t)}var X=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Q(r);if(n){var o=Q(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===$(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).attack=25,e.defence=25,e.type="vampire",e}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(p);function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function tt(){tt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var i=e&&e.prototype instanceof d?e:d,a=Object.create(i.prototype),c=new x(n||[]);return o(a,"_invoke",{value:j(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=s;var y="suspendedStart",h="suspendedYield",p="executing",v="completed",m={};function d(){}function b(){}function g(){}var w={};u(w,a,(function(){return this}));var P=Object.getPrototypeOf,S=P&&P(P(R([])));S&&S!==r&&n.call(S,a)&&(w=S);var k=g.prototype=d.prototype=Object.create(w);function O(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(o,i,a,c){var l=f(t[o],t,i);if("throw"!==l.type){var u=l.arg,s=u.value;return s&&"object"==Z(s)&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(s).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function j(e,r,n){var o=y;return function(i,a){if(o===p)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var l=C(c,n);if(l){if(l===m)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Z(e)+" is not iterable")}return b.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:b,configurable:!0}),b.displayName=u(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(E.prototype),u(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(k),u(k,l,"Generator"),u(k,a,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var l=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}var et=tt().mark(rt);function rt(t,e){var r,n,o,i;return tt().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t||!e){a.next=10;break}return r=1+Math.floor(Math.random()*e),n=new Map([["Bowman",new _(r)],["Daemon",new W(r)],["Magician",new H(r)],["Swordsman",new B(r)],["Undead",new z(r)],["Vampire",new X(r)]]),o=Math.floor(Math.random()*t.length),(i=n.get(t[o])).level>1&&i.levelUp(),a.next=8,i;case 8:a.next=0;break;case 10:case"end":return a.stop()}}),et)}function nt(t,e,r){for(var n=[],o=1;o<=r;o++){var i=rt(t,e).next().value;n.push(i)}return new L(n)}function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,at(n.key),n)}}function at(t){var e=function(t,e){if("object"!=ot(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:String(e)}var ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="GameRule"}var e,r;return e=t,r=[{key:"generatePlayerTeam",value:function(){return nt(["Bowman","Swordsman","Magician"],3,2)}},{key:"generateRivalTeam",value:function(){return nt(["Vampire","Undead","Daemon"],3,2)}},{key:"setActiveRival",value:function(t,e){var r=k.createBoard(e),n=["vampire","undead","daemon"],o=t.filter((function(t){return!n.includes(t.character.type)})),i=t.filter((function(t){return n.includes(t.character.type)})),a=o.map((function(t){return k.getLocation(t.position,r)})),c=i.map((function(t){return k.getLocation(t.position,r)})),l=i[k.findClosest(c,k.getAverage(a))];return localStorage.setItem("activeRival",l.position),l}},{key:"chooseRival",value:function(t){return t.filter((function(t){return t.position===Number(localStorage.activeRival)}))}},{key:"movementRadius",value:function(t,e){var r=new Map([["swordsman",4],["undead",4],["bowman",2],["vampire",2],["magician",1],["daemon",1]]);return k.neighboringPositions(t.position,e,r.get(t.character.type))}},{key:"attackRadius",value:function(t,e){var r=new Map([["swordsman",1],["undead",1],["bowman",2],["vampire",2],["magician",4],["daemon",4]]);return k.neighboringPositions(t.position,e,r.get(t.character.type))}},{key:"checkRivalMoves",value:function(e,r,n){var o=t.movementRadius(e,r),i=n.map((function(t){return t.position})),a=[];o.forEach((function(t){i.includes(t)||a.push(k.getLocation(t,k.createBoard(r)))}));var c=k.getLocation(Number(localStorage.activePlayer),k.createBoard(r));return o[k.findClosest(a,c)]}},{key:"checkRivalAttack",value:function(e,r,n){var o=t.attackRadius(e,n),i=[];return r.forEach((function(t){o.includes(t.position)&&i.push(t.position)})),i}},{key:"calculateDamage",value:function(t,e){var r=Math.floor(Math.max(t.character.attack-e.character.defence,.1*t.character.attack));return e.character.health-=r,r}},{key:"getPlayerCharacters",value:function(t){var e=["bowman","swordsman","magician"];return t.filter((function(t){return e.includes(t.character.type)}))}},{key:"getRivalCharacters",value:function(t){var e=["vampire","undead","daemon"];return t.filter((function(t){return e.includes(t.character.type)}))}},{key:"getCharacterByIndex",value:function(t,e){return e.filter((function(e){return e.position===t}))[0]}}],null&&it(e.prototype,null),r&&it(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,st(n.key),n)}}function st(t){var e=function(t,e){if("object"!=lt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lt(e)?e:String(e)}var ft=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storage=e}var e,r;return e=t,(r=[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}])&&ut(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pt(n.key),n)}}function pt(t){var e=function(t,e){if("object"!=yt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yt(e)?e:String(e)}var vt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"from",value:function(t){return new ft(localStorage).save(t),null}}],null&&ht(e.prototype,null),r&&ht(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bt(n.key),n)}}function bt(t){var e=function(t,e){if("object"!=mt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:String(e)}var gt=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gamePlay=e,this.stateService=r,this.characters=[],this.level=1,this.status=1}var e,r;return e=t,(r=[{key:"init",value:function(){var t=this;localStorage.removeItem("activePlayer"),localStorage.removeItem("activeRival"),this.status=1;var e=[];this.gamePlay.addNewGameListener((function(){return t.onNewGameClick})),this.gamePlay.addSaveGameListener((function(){return t.onSaveGameClick()})),this.gamePlay.addLoadGameListener((function(){return t.onLoadGameClick()})),1===this.level?(this.gamePlay.drawUi(c),this.playerTeam=ct.generatePlayerTeam(),this.rivalTeam=ct.generateRivalTeam(),this.playerTeam.characters.forEach((function(r){t.renderTeam(k.playerPosition(t.gamePlay.boardSize),r,e)}))):this.rivalTeam=ct.generateRivalTeam(),localStorage.setItem("nextPlayer",0),localStorage.activePlayer&&delete localStorage.activePlayer,this.rivalTeam.characters.forEach((function(r){t.renderTeam(k.rivalPosition(t.gamePlay.boardSize),r,e)})),this.gamePlay.redrawPositions(this.characters),this.gamePlay.addCellEnterListener((function(e){t.onCellEnter(e)&&t.showTip(e)})),this.gamePlay.addCellLeaveListener((function(e){t.onCellLeave(e)&&t.gamePlay.hideCellTooltip(e)})),this.gamePlay.addCellClickListener((function(e){return t.onCellClick(e)}))}},{key:"onCellClick",value:function(t){var e=this;if(1===this.status&&"0"===localStorage.nextPlayer){var r=["bowman","swordsman","magician"],n=this.characters;if(localStorage.activePlayer){var o=ct.getCharacterByIndex(Number(localStorage.activePlayer),n);if(this.characters.map((function(t){return t.position})).includes(t)){var i=ct.getCharacterByIndex(t,n);if(r.includes(i.character.type))this.setActivePlayer(t);else if(ct.attackRadius(o,this.gamePlay.boardSize).includes(t)){var c=ct.getCharacterByIndex(t,n);this.makeDamage(o,c),this.setNextPlayer()}}else ct.movementRadius(o,this.gamePlay.boardSize).includes(t)&&(o.position=t,this.setActivePlayer(t),this.gamePlay.redrawPositions(this.characters),this.setNextPlayer())}else this.characters.forEach((function(n){n.position===t&&(r.includes(n.character.type)?e.setActivePlayer(t):a.showError("Это не персонаж игрока"))}))}}},{key:"onCellEnter",value:function(t){var e=this.characters.map((function(t){return t.position}));if(1===this.status)return this.showOptions(t),!!e.includes(t)}},{key:"showOptions",value:function(t){if("0"===localStorage.nextPlayer&&localStorage.activePlayer){var e=ct.getCharacterByIndex(Number(localStorage.activePlayer),this.characters);e&&(this.characters.map((function(t){return t.position})).includes(t)?ct.getRivalCharacters(this.characters).map((function(t){return t.position})).includes(t)?ct.attackRadius(e,this.gamePlay.boardSize).includes(t)?(this.gamePlay.setCursor("crosshair"),this.gamePlay.selectCell(t,"red")):this.gamePlay.setCursor("not-allowed"):this.gamePlay.setCursor("pointer"):ct.movementRadius(e,this.gamePlay.boardSize).includes(t)?(this.gamePlay.setCursor("pointer"),this.gamePlay.selectCell(t,"green")):this.gamePlay.setCursor("not-allowed"))}}},{key:"onCellLeave",value:function(t){if(1===this.status){var e=this.characters.map((function(t){return t.position}));return Number(localStorage.activePlayer)!==t&&this.gamePlay.deselectCell(t),!!e.includes(t)}}},{key:"generateTip",value:function(t,e,r,n){return"🎖".concat(t," ⚔").concat(e," 🛡").concat(r," ❤").concat(n)}},{key:"showTip",value:function(t){var e=this;this.characters.forEach((function(r){if(r.position===t){var n=e.generateTip(r.character.level,r.character.attack,r.character.defence,r.character.health);e.gamePlay.showCellTooltip(n,t)}}))}},{key:"renderTeam",value:function(t,e,r){var n=k.generateRandom(t);r.includes(t[n])&&(n=k.generateRandom(t)),r.push(t[n]),this.characters.push(new g(e,t[n]))}},{key:"setActivePlayer",value:function(t){localStorage.activePlayer&&this.gamePlay.deselectCell(localStorage.activePlayer),this.gamePlay.selectCell(t),localStorage.setItem("activePlayer",t)}},{key:"setNextPlayer",value:function(){var t=this;1===this.status&&(this.healthListener(),localStorage.nextPlayer&&("0"===localStorage.nextPlayer?(localStorage.setItem("nextPlayer",1),setTimeout((function(){return t.runRivalTurn()}),500)):localStorage.setItem("nextPlayer",0)))}},{key:"runRivalTurn",value:function(){var t=ct.setActiveRival(this.characters,this.gamePlay.boardSize);this.moveOrAttack(t),this.setNextPlayer()}},{key:"moveOrAttack",value:function(){var t=ct.getCharacterByIndex(Number(localStorage.activeRival),this.characters),e=ct.checkRivalAttack(t,ct.getPlayerCharacters(this.characters),this.gamePlay.boardSize),r=ct.getCharacterByIndex(e[0],this.characters);e.length?(1!==e.length&&(r=(r=this.characters.filter((function(t){return e.includes(t.position)}))).sort((function(t,e){return t.character.health-e.character.health}))[0]),this.makeDamage(t,r)):(t.position=ct.checkRivalMoves(t,this.gamePlay.boardSize,this.characters),this.gamePlay.redrawPositions(this.characters))}},{key:"makeDamage",value:function(t,e){var r=this,n=this.characters,o=ct.calculateDamage(t,e);this.gamePlay.showDamage(e.position,o).then((function(){return r.gamePlay.redrawPositions(n)})),this.healthListener()}},{key:"levelUp",value:function(){if(4!==this.level){this.level+=1;var t=new Map([[1,c],[2,l],[3,u],[4,s]]);this.init(),this.gamePlay.drawUi(t.get(this.level)),ct.getPlayerCharacters(this.characters).forEach((function(t){t.character.level+=1,t.character.levelUp(),t.character.health+=80,t.character.health>100&&(t.character.health=100)})),this.gamePlay.redrawPositions(this.characters)}else this.gameOver()}},{key:"healthListener",value:function(){for(var t=[],e=0;e<this.characters.length;e++)this.characters[e].character.health<=0&&t.push(e);if(t.length){if(this.characters[t[0]].position===Number(localStorage.activePlayer)?(this.gamePlay.setCursor("default"),localStorage.removeItem("activePlayer")):this.characters[t[0]].position===Number(localStorage.activeRival)&&localStorage.removeItem("activeRival"),this.gamePlay.deselectCell(this.characters[t[0]].position),this.characters.splice(t[0],1),this.gamePlay.redrawPositions(this.characters),!ct.getPlayerCharacters(this.characters).length)return void this.gameOver();ct.getRivalCharacters(this.characters).length||this.levelUp()}}},{key:"gameOver",value:function(){var t=this;this.gamePlay.setCursor("default"),this.status=0,this.characters.forEach((function(e){t.gamePlay.deselectCell(e.position)})),this.gamePlay.addNewGameListener((function(){t.level=1,t.init()}))}},{key:"onNewGameClick",value:function(){this.level=1,this.characters=[],this.init()}},{key:"onSaveGameClick",value:function(){vt.from(this)}},{key:"onLoadGameClick",value:function(){var t=this;if(localStorage.state){this.characters.forEach((function(e){t.gamePlay.deselectCell(e.position)})),this.gamePlay.setCursor("default");var e=new ft(localStorage).load();this.characters=e.characters,this.level=e.level,this.status=e.status,this.gamePlay.redrawPositions(this.characters)}}}])&&dt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),wt=new a;wt.bindToDOM(document.querySelector("#game-container")),new gt(wt,new ft(localStorage)).init()})();